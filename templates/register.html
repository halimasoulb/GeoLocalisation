{% extends "layout.html" %}
{% block content %}
    <script>
        $(document).ready(function () {
            
            $('#employe').change(function(){
                var selected =  $(this).children('option:selected').text();

                if(selected == "oui"){
                    $("#si-employe-province").show('slow');
                }
                if(selected == "non"){
                    $("#si-employe-province").hide('slow');
                }
            });

            $(function () {
                 $('#datePicker').datetimepicker({
                    altField: "#datepick",
                    closeText: 'Fermer',
                    prevText: 'Précédent',
                    nextText: 'Suivant',
                    currentText: 'Aujourd\'hui',
                    monthNames: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
                    monthNamesShort: ['Janv.', 'Févr.', 'Mars', 'Avril', 'Mai', 'Juin', 'Juil.', 'Août', 'Sept.', 'Oct.', 'Nov.', 'Déc.'],
                    dayNames: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
                    dayNamesShort: ['Dim.', 'Lun.', 'Mar.', 'Mer.', 'Jeu.', 'Ven.', 'Sam.'],
                    dayNamesMin: ['D', 'L', 'M', 'M', 'J', 'V', 'S'],
                    weekHeader: 'Sem.',
                    dateFormat: 'yy-mm-dd'
                });

            })

            $(function () {
                $('#datePicker').datetimepicker();
                $('#datepick').datetimepicker();
            })

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    currentPosition = {
                                        'latitude': position.coords.latitude,
                                        'longitude': position.coords.longitude
                                      } 
                    $.ajax({
                        url: '/position',
                        type: 'POST',
                        data: JSON.stringify(currentPosition),
                        contentType: 'application/json;charset=UTF-8',
                        cache:false,
                        error: function(response){
                            alert('Error sending position')
                        }
                    });
                });
            } 
            else {
                alert("Geolocation is not supported by this browser.");
            }


            $("#pachalik").change(function(){
                $.ajax({
                    url: '/selectform',
                    type: 'POST',
                    data: $('#aal').serialize(),
                    success: function(selectOptions){
                        for (var i = 0; i < selectOptions.length; i++){
                            $("#aal").append(
                                $("<option></option>").attr("value", selectOptions[i][0]).text(selectOptions[i][1])
                                );
                        }
                    }
                });
            });
        })
        
        
        
    </script>
    <div class="register-section box" >
        <form method="POST" action="">
            {{ form.hidden_tag() }}
            {% from "_formhelpers.html" import render_field, render_radio %}
            <fieldset class="form-group">
                <legend class="border-bottom mb-4 col-md-12">Enregistrer Nouveaux Cas</legend>
                <div class="form-group col-md-6" >
                    {{render_field(form.nom)}}
                </div>
                <div class="form-group col-md-6">
                    {{render_field(form.prenom)}}  
                </div>
                <div class="form-group col-md-6" >
                    {{render_field(form.sexe)}}  
                </div>
                <div class="form-group col-md-6" >
                    {{render_field(form.cin)}}
                </div>
                <div class="form-group  datepicker col-md-4" data-provide="datepicker">
                    {{render_field(form.date_de_naissance)}}
                </div>
                <div class="form-group col-md-8">
                    {{render_field(form.adresse)}}
                </div>
                <div class="form-group col-md-12">
                    {{render_field(form.date)}}
                </div>
                <legend class="border-bottom mb-4 col-md-12">Informations complementaires</legend>
                <div class="form-group col-md-12" id="pachalik">
                    {{render_field(form.pachalik)}}
                </div>
                <div class="form-group col-md-12" id="aal">
                    {{render_field(form.aal)}}
                </div>
                <div class="form-group col-md-12">
                    {{render_field(form.residance)}}
                </div>
                <div class="form-group col-md-12" id="employe" >
                    {{render_field(form.employe)}}
                </div>
                <div class="form-group col-md-6" id="si-employe-province">
                    {{render_field(form.id_societe)}}
                </div>
                 <div class="form-group col-md-6" id="si-employe-province">
                    {{render_field(form.nom_societe)}}
                </div>
                <div class="form-group col-md-12">
                    {{render_field(form.observation)}}
                </div>

            </fieldset>
            <div class="form-group">
                {{ form.submit(class="btn btn-outline-info") }}
            </div>
        </form>
    </div>
     <div id="mapid"></div>
{% endblock content %}
